---
# multilingual page pair id, this must pair with translations of this page. (This name must be unique)
# lng_pair: id_autogeneratedsamplecontent_1
title: íšŒì›ê°€ì…ì— BCrypt ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ ì ìš©

# post specific
# if not specified, .name will be used from _data/owner.yml
#author: "Dante"
# multiple category is not supported
category: auto generated
# multiple tag entries are possible`
tags: [Database, DB]
# thumbnail image for post
img: ":SignUp.jpg"
# disable comments on this page
comments_disable: true

# publish date
date: 2022-08-12 23:35:00 +0900

# seo
# if not specified, date will be used.
#meta_modify_date: 2022-08-12 23:35:00 +0900
# check the meta_common_description in _data/lang/[language].yml
#meta_description: ""

# optional
# if you enabled image_viewer_posts you don't need to enable this. This is only if image_viewer_posts = false
#image_viewer_on: true
# if you enabled image_lazy_loader_posts you don't need to enable this. This is only if image_lazy_loader_posts = false
#image_lazy_loader_on: true
# exclude from on site search
#on_site_search_exclude: true
# exclude from search engines
#search_engine_exclude: true
# to disable this page, simply set published: false or delete this file
#published: false
---
{%- comment -%} Please delete below and place your page content here {%- endcomment -%}

{%- include util/auto-content-generator.liquid -%}

<!-- outline-start -->
# íšŒì›ê°€ì…ì— BCrypt ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜ ì ìš© ë° ê¶Œí•œ ì„¤ì • ë„£ì–´ì£¼ê¸°

`ë¹„í¬ë¦½íŠ¸`ë¡œ íšŒì›ê°€ì…í•˜ê³  ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” í•˜ê¸°

ì•”í˜¸í™” í•˜ëŠ” ì´ìœ  : í´ë¼ì´ì–¸íŠ¸ê°€ ì¤€ ë°ì´í„°ë“¤ì„ ë°›ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ë„£ì„ ë•Œ ë¹„ë°€ë²ˆí˜¸ê°€ ì•”í˜¸í™”ê°€ ì•ˆëœë‹¤. ì•”í˜¸í™”ë¥¼ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ” ì•”í˜¸ë¥¼ ê°€ë ¤ë³´ì.

## **BCrypt** ì•”í˜¸í™”

ë¹„í¬ë¦½íŠ¸ë€?

```java
â”œâ”€ğŸ“COME.COS.photogram
   â”‚
   â””â”€ğŸ“config
       â”‚
       â””â”€ ğŸ“¦Â SecurityConfig.java

```

- ê¸°ì¡´ì˜ ì½”ë“œ

```java
@EnableWebSecurity // 2.í•´ë‹¹ íŒŒì¼ë¡œ ì‹œíë¦¬í‹°ë¥¼ í™œì„±í™” ì‹œì¼œì¤€ë‹¤.
@Configuration // 1. IoCì— ë“±ë¡í•´ì£¼ëŠ” ê²ƒ
public class SecurityConfig extends WebSecurityConfigurerAdapter {


    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable();
        http.authorizeRequests().antMatchers("/", "/user/**", "/image/**", "subscribe/**", "/comment/**").authenticated()
                .anyRequest().permitAll()
                .and()
                .formLogin()
                .loginPage("/auth/signin")
                .defaultSuccessUrl("/");
    }
}
```

- IoCì— BcryptPasswordEncoder ë“±ë¡

```java
    @Bean
		public BcryptPasswordEncoder enocode() {
			return new BcryptPasswordEncoder();
		}

```

applicationì´ ì‹¤í–‰ë˜ë©´ì„œ SecurityConfig ê°€ IoCì— ë“±ë¡ë  ë•Œ @Beanì„ ì½ì–´ì„œ `return new BcryptPasswordEncoder();` í•´ì„œ IoCì— BcryptPasswordEncoder ë“±ë¡ì„ í•œë‹¤.

- Serviceì—ì„œ ì‚¬ìš©
  - `private final BcryptPasswordEncoder bcryptPasswordEncoder;` ì¶”ê°€
  - `String rawPassword = user.getPassword();` ì¶”ê°€
  - `String encPassword = bcryptPasswordEncoder.encode(rawPassword);` ì¶”ê°€


**encPasswordëŠ” ì•”í˜¸íšŒëœ Passwordë¥¼ ê°–ê³ ìˆë‹¤. (í•´ì‹œë¡œ ë˜ì–´ìˆë‹¤. )**

```java
@RequiredArgsConstructor
@Service
public class AuthService {
    private final UserRepository userRepository;
		private final BcryptPasswordEncoder bcryptPasswordEncoder;

		@Transactional
    public User íšŒì›ê°€ì…(User user){
				String rawPassword = user.getPassword();
			  String encPassword = bcryptPasswordEncoder.encode(rawPassword);
        User userEntity =userRepository.save(user);
        return userEntity;
    }
}
```

- Password ì•”í˜¸í™”

```java
@RequiredArgsConstructor
@Service
public class AuthService {

    private final UserRepository userRepository;
		private final BcryptPasswordEncoder bcryptPasswordEncoder;

		@Transactional
    public User íšŒì›ê°€ì…(User user){
				String rawPassword = user.getPassword();
			  String encPassword = bcryptPasswordEncoder.encode(rawPassword);

				user.setPassword(encPassword); **// íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ë¨**

        User userEntity =userRepository.save(user);
        return userEntity;
    }
}
```

- ê¶Œí•œ ë„£ì–´ì£¼ê¸°

`user.setRole("ROLE_USER);`

```java
@RequiredArgsConstructor
@Service
public class AuthService {

    private final UserRepository userRepository;
		private final BcryptPasswordEncoder bcryptPasswordEncoder;

		@Transactional
    public User íšŒì›ê°€ì…(User user){
				String rawPassword = user.getPassword();
			  String encPassword = bcryptPasswordEncoder.encode(rawPassword);

				user.setPassword(encPassword); **// íŒ¨ìŠ¤ì›Œë“œ ì•”í˜¸í™” ë¨**
				user.setRole("ROLE_USER); //ê´€ë¦¬ì ROLE_ADMIN
        User userEntity =userRepository.save(user);
        return userEntity;
    }
}
```

- username ì´ ì¤‘ë³µëœë‹¤.. ì¤‘ë³µëœ ê²ƒì„ ëª»ë§Œë“¤ê²Œí•˜ê¸°

ì–´ë–»ê²Œ ì¤‘ë³µì„ ì—†ì•¨ê¹Œ ?

```java
@Builder
@AllArgsConstructor // lombok embedded
@NoArgsConstructor // lombok embedded
@Data // lombok embedded
@Entity
public class User {


    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) //ë²ˆí˜¸ ì¦ê°€ ì „ëµì´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë”°ë¼ê°„ë‹¤.
    private int id;

    private String username;
    private String password;

    private String name;
    private String website;
    private String bio;
    private String email;
    private String phone;
    private String gender;

    private String profileimageUrl;
    private String role;

    private LocalDateTime createDate;

    @PrePersist
    public void createDate(){
        this.createDate = LocalDateTime.now();
    }

}
```

**@Column(unique = true) ë¥¼ ì‚¬ìš©í•˜ì—¬ usernameì´ ì¤‘ë³µë˜ëŠ” ê²ƒì€ ì•ˆë˜ê²Œ unique ì œì•½ ì¡°ê±´ì„ ê±¸ì–´ì¤€ë‹¤.**

```java
@Builder
@AllArgsConstructor // lombok embedded
@NoArgsConstructor // lombok embedded
@Data // lombok embedded
@Entity
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) //ë²ˆí˜¸ ì¦ê°€ ì „ëµì´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë”°ë¼ê°„ë‹¤.
    private int id;

		@Column(unique = true)
    private String username;
    private String password;

    private String name;
    private String website;
    private String bio;
    private String email;
    private String phone;
    private String gender;

    private String profileimageUrl;
    private String role;

    private LocalDateTime createDate;

    @PrePersist
    public void createDate(){
        this.createDate = LocalDateTime.now();
    }

}
```

ì´ë²ˆ ê¸€ì—ì„œ ë¹„í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™” í•´ì£¼ê³  ê¶Œí•œ ì„¤ì •ê¹Œì§€ ë„£ì–´ì£¼ì—ˆë‹¤.

ì—¬ê¸°ì„œ ìƒê°ë‚˜ëŠ” ê²ƒì€ ì œì•½ì¡°ê±´ì„ enumë¡œ ë§Œë“¤ì–´ë ê¹Œ? ë¼ëŠ” ê³ ë¯¼ì„ í–ˆë‹¤. 1ì°¨ ë¦¬íŒ©í† ë§ í•  ë•Œ ì´ ê¸€ì„ ë‹¤ì‹œë³´ë©´ì„œ enumìœ¼ë¡œ êµ¬í˜„ì„ ê°€ëŠ¥í•œì§€  ì•Œì•„ë´ì•¼ê² ë‹¤.

### ì •ë¦¬

- **BCrypt ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜**
- **ê¶Œí•œ ë„£ì–´ì£¼ê¸°**
- **@Column(unique = true)  ì¤‘ë³µ ìƒì„± ë¶ˆê°€í•˜ê²Œ ë§Œë“¤ê¸°**

<!-- outline-end -->
