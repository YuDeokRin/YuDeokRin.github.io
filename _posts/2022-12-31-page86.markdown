---
# multilingual page pair id, this must pair with translations of this page. (This name must be unique)
# lng_pair: id_autogeneratedsamplecontent_1
title: Effective-Java(Item13)

# post specific
# if not specified, .name will be used from _data/owner.yml
#author: "Dante"
# multiple category is not supported
category: auto generated
# multiple tag entries are possible
tags: [Effective_Java, Java]
# thumbnail image for post
img: ":Eff3.jpg"
# disable comments on this page
comments_disable: true

# publish date
date: 2022-12-31 17:55:00 +0900

# seo
# if not specified, date will be used.
#meta_modify_date: 2022-12-31 17:55:00 +0900
# check the meta_common_description in _data/lang/[language].yml
#meta_description: ""

# optional
# if you enabled image_viewer_posts you don't need to enable this. This is only if image_viewer_posts = false
#image_viewer_on: true
# if you enabled image_lazy_loader_posts you don't need to enable this. This is only if image_lazy_loader_posts = false
#image_lazy_loader_on: true
# exclude from on site search
#on_site_search_exclude: true
# exclude from search engines
#search_engine_exclude: true
# to disable this page, simply set published: false or delete this file
#published: false
---
{%- comment -%} Please delete below and place your page content here {%- endcomment -%}

{%- include util/auto-content-generator.liquid -%}

<!-- outline-start -->

# item 13. clone ì¬ì •ì˜ëŠ” ì£¼ì˜í•´ì„œ ì§„í–‰í•˜ë¼.

## clone() ë©”ì†Œë“œëŠ” ë¬´ì—‡ì¼ê¹Œ?

[Java clone ë©”ì†Œë“œ ê°„ëµíˆ ì•Œì•„ë³´ì.](https://yudeokrin.github.io/posts/2022-12-30-page85)

ê¸€ì´ ê¸´ ê²ƒì€ ê°€ë…ì„±ì´ ì¢‹ì§€ ì•Šê¸° ë•Œë¬¸ì— `clone`ì„ ì •ë¦¬í•´ì„œ ë¸”ë¡œê·¸ì— ì •ë¦¬í•´ë†¨ë‹¤.

---

[ì–•ì€ ë³µì‚¬ì™€ ê¹Šì€ ë³µì‚¬](https://yudeokrin.github.io/posts/2022-12-29-page84)

clone() ë©”ì†Œë“œë¥¼ ë°°ìš°ê¸°ì— ì•ì„œ ì–•ì€ ë³µì‚¬ì™€ ê¹Šì€ ë³µì‚¬ì˜ ê°œë…ì„ ìˆ™ì§€í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ì•„ì„œ ì •ë¦¬í•´ë´¤ë‹¤.

---

## Cloneable ì¸í„°í˜ì´ìŠ¤ì˜ ì—­í• 

- cloneableì€ í´ë˜ìŠ¤ì„ ë³µì œë¥¼ í•  ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸°ìœ„í•œ ìš©ë„ë¡œ ì“°ì¸ë‹¤. â†’ ì´ëŸ° ì¸í„°í˜ì´ìŠ¤ë¥¼  `minxin interface` ë¼ê³  ë¶€ë¥¸ë‹¤.

<aside>
ğŸ’¡ **mixin (ë¯¹ìŠ¤ì¸)ì´ë€?**
í´ë˜ìŠ¤ê°€ ë³¸ì¸ì˜ ê¸°ëŠ¥ ì´ì™¸ì— ì¶”ê°€ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆëŠ” ìë£Œí˜•ìœ¼ë¡œ, ì–´ë–¤ ì„ íƒì  ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤ëŠ” ì‚¬ì‹¤ì„ ì„ ì–¸í•˜ê¸° ìœ„í•´ ì“°ì¸ë‹¤.

</aside>

## cloneì˜ ê·œì•½

### 1. x.clone() â‰  x

â†’ ë°˜ë“œì‹œ true

### 2. x.clone().getClass() == x.getClass()

â†’ ë°˜ë“œì‹œ true

### 3. x.clone().equals(x)

â†’ trueì¼ ìˆ˜ë„ ìˆê³  ì•„ë‹ ìˆ˜ë„ ìˆë‹¤.

### 4. x.clone.getClass() == x.getClass()

ê´€ë¡€ìƒ, ë°˜í™˜ëœ ê°ì²´ì™€ ì›ë³¸ ê°ì²´ëŠ” ë…ë¦½ì ì´ì–´ì•¼ í•œë‹¤. ì´ë¥¼ ë§Œì¡±í•˜ë ¤ë©´ super.cloneìœ¼ë¡œ ì–»ì€ ê°ì²´ì˜ í•„ë“œ ì¤‘ í•˜ë‚˜ ì´ìƒì„ ë°˜í™˜ ì „ì— ìˆ˜ì •í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤.

---

## ê°€ë³€ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” clone ì •ì˜

- ê°€ë³€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ìš© clone ë©”ì„œë“œ

```java
@Override
public PhoneNumber clone() {
    try {
        return (PhoneNumber) super.clone();
    } catch (CloneNotSupportedException e) {
        throw new AssertionError(); // ì¼ì–´ë‚  ìˆ˜ ì—†ëŠ” ì¼.
    }
}
```

- ì›ë˜ cloneì˜ ëª¨ìŠµ

```java
@Override
protected Object clone() throws CloneSupportedException {
    return super.clone();
}
```

ì–´ë–¤ í´ë˜ìŠ¤(Object)ë¥¼ ìƒì†ë°›ì•„ì„œ Overridingì„ í•  ë•Œ, ì ‘ê·¼ ì§€ì‹œìëŠ” ìƒìœ„ í´ë˜ìŠ¤ì— ìˆëŠ” ì ‘ê·¼ì§€ì‹œìì™€ ê°™ê±°ë‚˜ ë” ë„“ì€ ë²”ìœ„ì˜ ì ‘ê·¼ ì§€ì‹œìë¥¼ ê°€ì ¸ì•¼í•œë‹¤.

<aside>
ğŸ’¡ **ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘(convariant return typing)**
ë©”ì„œë“œë¥¼ Overriding(ì¬ì •ì˜)í•  ë•Œ ì¬ì •ì˜ ëœ ë©”ì„œë“œì˜ ë°˜í™˜ íƒ€ì…ì´ ìƒìœ„ í´ë˜ìŠ¤ì˜ ë©”ì„œë“œê°€ ë°˜í™˜í•˜ëŠ” í•˜ìœ„ ìœ í˜•ì´ ë  ìˆ˜ ìˆë‹¤ ë¼ëŠ” ê²ƒ

</aside>

- ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘ ì˜ˆì œ

![Untitled](item%2013%20clone%20%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%8B%E1%85%B4%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%B4%E1%84%92%E1%85%A2%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%B5%E1%86%AB%E1%84%92%E1%85%A2%E1%86%BC%E1%84%92%E1%85%A1%E1%84%85%E1%85%A1%20e00769e1a3474e108c35f20a4f828627/Untitled.png)

### ê³µë³€ ë°˜í™˜ íƒ€ì´í•‘ì˜ ì¥ì 

- clone()ì´ë¼ëŠ” ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì—ì„œ `íƒ€ì… ìºìŠ¤íŒ…`ì„ í•˜ì§€ ì•Šì•„ë„ëœë‹¤.

---

## ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” clone ë©”ì†Œë“œ ì¬ì •ì˜

- ì•„ë˜ì˜ ì˜ˆì œ(ì„œì ì— ë‚˜ì˜¨ ì˜ˆì œ)ë¡œ ì„¤ëª…ì„ í•˜ê² ìŠµë‹ˆë‹¤.

```java
import java.util.Arrays;

// Stackì˜ ë³µì œ ê°€ëŠ¥ ë²„ì „ (80-81ìª½)
public class Stack implements Cloneable {
    private Object[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;

    public Stack() {
        this.elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }

    public void push(Object e) {
        ensureCapacity();
        elements[size++] = e;
    }

    public Object pop() {
        if (size == 0)
            throw new EmptyStackException();
        Object result = elements[--size];
        elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
        return result;
    }

    public boolean isEmpty() {
        return size ==0;
    }

    // ì›ì†Œë¥¼ ìœ„í•œ ê³µê°„ì„ ì ì–´ë„ í•˜ë‚˜ ì´ìƒ í™•ë³´í•œë‹¤.
    private void ensureCapacity() {
        if (elements.length == size)
            elements = Arrays.copyOf(elements, 2 * size + 1);
    }

    @Override public Stack clone() {
        try {
            Stack result = (Stack) super.clone();
            return result;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }

}
```

### ê°€ë³€ ê°ì²´ì˜ clone êµ¬í˜„í•˜ëŠ” ë°©ë²•

1. `Cloneable` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì•¼í•œë‹¤.
2. `clone()` ë©”ì†Œë“œë¥¼ ì¬ì •ì˜í•´ì•¼í•œë‹¤. â†’ ì¬ì •ì˜í•  ë•Œ, `protected` â†’ `public` ìœ¼ë¡œ ë³€ê²½í•´ì£¼ê³ , return íƒ€ì…ì„ `Object` ì—ì„œ í´ë˜ìŠ¤ íƒ€ì…ìœ¼ë¡œ ë³€ê²½í•´ì¤€ë‹¤.
3. `super.clone()` í˜¸ì¶œí•´ì¤€ë‹¤.

3ë²ˆê¹Œì§€ëŠ” `ê°€ë³€ ìƒíƒœë¥¼ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” clone` í•˜ê³  ê°™ë‹¤.

ì´ì œ ì•„ë˜ë¶€í„°ëŠ” ê°€ë³€ ê°ì²´ì˜ clone êµ¬í˜„ ë°©ë²•ì„ ì•Œì•„ë³´ì.

1. `stack, copy -> elementsS[0, 1]`  â†’ stackê³¼ copy(result) ë™ì¼í•œ elementsë¥¼ ì°¸ì¡°í•œë‹¤. ì¦‰, ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë™ì¼í•œ ë°°ì—´ì„ ì°¸ì¡°í•˜ëŠ” ê²ƒì´ ëœë‹¤.

ë”°ë¼ì„œ ì›ë³¸ì´ë‚˜ ë³µì œë³¸ ì¤‘ í•˜ë‚˜ë¥¼ ìˆ˜ì •í•˜ê²Œ ëœë‹¤ë©´ ë‹¤ë¥¸ í•˜ë‚˜ë„ ìˆ˜ì •ë˜ì–´ ë¶ˆë³€ì‹ì˜ ê¹¨ëœ¨ë¦°ë‹¤.  â†’ ë¶ˆì•ˆí•œ ì½”ë“œë‹¤.

![Untitled](item%2013%20clone%20%E1%84%8C%E1%85%A2%E1%84%8C%E1%85%A5%E1%86%BC%E1%84%8B%E1%85%B4%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%B4%E1%84%92%E1%85%A2%E1%84%89%E1%85%A5%20%E1%84%8C%E1%85%B5%E1%86%AB%E1%84%92%E1%85%A2%E1%86%BC%E1%84%92%E1%85%A1%E1%84%85%E1%85%A1%20e00769e1a3474e108c35f20a4f828627/Untitled%201.png)

```java
public static void main(String[] args) {
    Object[] values = new Object[2];
    values[0] = new PhoneNumber(123, 456, 7890);
    values[1] = new PhoneNumber(321, 764, 2341);

    Stack stack = new Stack();
    for (Object arg : values)
        stack.push(arg);

    Stack copy = stack.clone();

    System.out.println("-----pop from stack-----");
    while (!stack.isEmpty())
        System.out.println(stack.pop() + " ");

    System.out.println("-----pop from copy-----");
    while (!copy.isEmpty())
        System.out.println(copy.pop() + " ");

    System.out.println("-----ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ì¸ê°€ìš”?-----");
    System.out.println(stack.elements[0] == copy.elements[0]); // ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ í™•ì¸ í•˜ëŠ” ì½”ë“œ
}
```

```java
ê²°ê³¼ :
-----pop from stack-----
321-764-2341
123-456-7890
-----pop from copy-----
null
null
-----ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ì¸ê°€ìš”?-----
true
```

ìœ„ì™€ ê°™ì´ ê²°ê³¼ê°€ stackì—ì„œ popì„ í–ˆëŠ”ë° copyì—ë„ ì˜í–¥ì„ ì¤€ë‹¤.

---

1. 4ë²ˆì„ ê·¹ë³µí•˜ë ¤ë©´ `result.elements = elements.clone()` ë¥¼ ì¶”ê°€ í•´ì¤€ë‹¤.   â†’ `ì–•ì€ ë³µì‚¬`

ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ë©´, ì¸ìŠ¤í„´ìŠ¤ëŠ” ë™ì¼í•˜ì§€ë§Œ ê°ê° ë°°ì—´ì„ ë§Œë“¤ì–´ì„œ ë³µì‚¬ë¥¼ í•œë‹¤. í•˜ì§€ë§Œ ì–•ì€ ë³µì‚¬ì´ê¸°ë•Œë¬¸ì— ì¸ìŠ¤í„´ìŠ¤ëŠ” ê°™ë‹¤.  ì‹¤ì œ ë°°ì—´ ì•ˆì— ì¸ìŠ¤í„´ìŠ¤ê¹Œì§€ ì™„ì „íˆ ìƒˆë¡œìš´ ë³µì‚¬ë¥¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤.

ë”°ë¼ì„œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¡°ì‘í•œë‹¤ë©´, `copy()`ë¥¼ ê°–ê³  ìˆëŠ” `PhoneNumber`í´ë˜ìŠ¤ì— ì˜í–¥ì„ ì¤€ë‹¤. â†’ ë¶ˆì•ˆí•œ ì½”ë“œ

```java
@Override
public Stack clone() {
    try {
        Stack result = (Stack) super.clone();
        result.elements = elements.clone(); // ì¶”ê°€ëœ ì†ŒìŠ¤ ì½”ë“œ
        return result;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}
```

- `result.elements = elements.clone()` ì¶”ê°€í•  ê²½ìš° ê²°ê³¼

```java
-----pop from stack-----
321-764-2341
123-456-7890
-----pop from copy-----
321-764-2341
123-456-7890
-----ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ì¸ê°€ìš”?-----
true
```

ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì´ì§€ë§Œ ê°ê° ë°°ì—´ì„ ë§Œë“œëŠ” ë°©ì‹ìœ¼ë¡œ ë°”ë€ë‹¤.

---

### **ê°€ë³€ ìƒíƒœë¥¼ ê°–ëŠ” í´ë˜ìŠ¤ìš© ì¬ê·€ì  cloneë©”ì„œë“œ ì¬ì •ì˜**

1. 5ë²ˆì§¸ë¥¼ ê·¹ë³µí•˜ëŠ”ë°©ë²• â†’ `ê¹Šì€ ë³µì‚¬(deep copy)` ë¥¼ í•œë‹¤.

```java
package me.chapter03.item13;

public class HashTable implements Cloneable {
    private Entry[] buckets = new Entry[10];

    private static class Entry{
        final Object key;
        Object value;
        Entry next;

        public Entry(Object key, Object value, Entry next) {
            this.key = key;
            this.value = value;
            this.next = next;
        }

        public void add(Object key, Object value) {
            this.next = new Entry(key, value, null);
        }

        public Entry deepCopy(){
            return new Entry(key, value, next == null ? null : next.deepCopy());
        }

//    shallow copy
//    @Override
//    protected HashTable clone() {
//        HashTable result = null;
//        try{
//            result = (HashTable) super.clone();
//            result.buckets = this.buckets.clone(); // p82. shallow copyì´ê¸° ë•Œë¬¸ì— ìœ„í—˜í•˜ë‹¤.
//            return result;
//        }catch(CloneNotSupportedException e){
//            throw new AssertionError();
//        }
//    }

//  deep copy
    @Override
    protected Object clone() {
        HashTable result = null;
        try {
            result = (HashTable) super.clone(); // ë°°ì—´ì„ cloneì´ ì•„ë‹Œ ì§ì ‘ë§Œë“¬.
            result.buckets = new Entry[this.buckets.length]; // cloneìš© buckets ë°°ì—´
            for (int i = 0; i < this.buckets.length; i++) {
                if (buckets[i] != null) {
                    result.buckets[i] = this.buckets[i].deepCopy(); // p83. deep copy
                }
            }
            return result;
        } catch (CloneNotSupportedException e) {
            throw new AssertionError();
        }
    }

    public static void main(String[] args) {
        HashTable hashTable = new HashTable();
        Entry entry = new Entry(new Object(), new Object(), null);
        hashTable.buckets[0] = entry;
        HashTable clone = hashTable.clone();
        System.out.println(hashTable.buckets[0] == entry);
        System.out.println(hashTable.buckets[0] == clone.buckets[0]);
    }
}
```

```java
public Entry deepCopy(){
    return new Entry(key, value, next == null ? null : next.deepCopy());
}
```

Entryì˜ deepCopy ë©”ì„œë“œëŠ”


<!-- outline-end -->
